% Whisker barrel generation paper equations, for pasting into Google
% docs draft.

% While writing, don't stop for errors
%\nonstopmode

\documentclass[a4paper,11pt]{article}
\usepackage{amsmath,amssymb,mathtools}
\usepackage{enumerate}
\usepackage{times}
\usepackage[usenames]{color}
\usepackage{parskip}
\usepackage{afterpage}
\usepackage{setspace}
\usepackage[modulo]{lineno}
%\usepackage{xltxtra}
%\usepackage{xunicode}
\usepackage{gensymb}

\usepackage{titlesec}
\titleformat*{\section}{\LARGE\bfseries}
\titleformat*{\subsection}{\Large\bfseries}
\titleformat*{\subsubsection}{\large\bfseries}
\titleformat*{\paragraph}{\large\bfseries}
\titleformat*{\subparagraph}{\large\bfseries}


\setcounter{tocdepth}{3}
\usepackage{graphicx}
\usepackage{comment}
\usepackage{textcomp}
\usepackage{natbib}

\usepackage{lmodern}

\usepackage[labelfont=bf,labelsep=period,justification=justified]{caption}

\doublespacing
\topmargin 0.0cm
\oddsidemargin 0.5cm
\evensidemargin 0.5cm
\textwidth 16cm
\textheight 21cm
\makeatletter
\makeatother
\date{}
\pagestyle{plain}

% Blue for comments
\newcommand{\cmnt}[1]{\textcolor{blue}{#1}}
% Code in sans serif
\newcommand{\code}[1]{\textsf{#1}}
% Divergence symbol (Del dot Del)
\newcommand{\dvrg}{\nabla\vcdot\nabla}
% Emphasis shortcut
\newcommand{\e}{\emph}
% Bold shortcut
\newcommand{\bol}{\textbf}
% Math bold
\newcommand{\mb}[1]{\mathbf{#1}}
\makeatletter
\newcommand*\vcdot{\mathpalette\vcdot@{.35}}
\newcommand*\vcdot@[2]{\mathbin{\vcenter{\hbox{\scalebox{#2}{$\m@th#1\bullet$}}}}}
\makeatother

%\bibliographystyle{plos2015}
\bibliographystyle{apalike}


\begin{document}
%\begin{center}
\begin{flushleft}
{\huge
\textbf{Self-organization of whisker barrels in simulation requires competition between thalamocortical axons}
 \vspace{5em}
}
%\end{center}

Sebastian~S.~James$^{1*}$, Stuart~P.~Wilson$^{1}$ \vspace{1em}\\
$^{1}$Department of Psychology, The University of Sheffield, Sheffield, United Kingdom.\vspace{1em}\\
$^{*}$Corresponding author email: Seb.James@Sheffield.ac.uk\vspace{1em}\\
Short title: Self-organising whisker barrels\vspace{5em}\\
\end{flushleft}

\newpage{}
%\raggedright

\section*{Abstract}

Understanding how genetic information and spontaneous pattern formation
together give rise to the whisker barrels is an important challenge for
developmental neurobiology. The barrel patterning that coalesces in layer IV
has been described formally as a Voronoi tesselation, which is indicative of
an underlying developmental process based on local competitive
interactions. If pattern formation relies only on such intrinsic
self-organising processes, how can the somatotopic order at the periphery be
maintained in the projections from brainstem to thalamus and from thalamus to
cortex? To investigate, we began by extending a computational model of
neocortical arealization by Karbowski \& Ermentrout (2004; J. Comp. Neurosci.)
to generate fields on a two-dimensional cortical sheet. Central to this model
is an assumption that axonal branching and synaptogenesis are coupled, and
that thalamic projections compete for cortical territory under the influence
of molecular signalling gradients. We found that these processes alone are
incapable of generating patterns of cortical fields that are more intricate
than the patterns already present in molecular guidance signals. However, a
full barrel-field pattern emerges under the guidance of as few as four
signalling gradients when the model is extended to introduce competition
between the branches of axons that originate from different thalamic
barreloids. We show that the key requirements for the emergence of realistic
(Voronoi tesselation) patterning are i) at each cortical location
thalamocortical projections compete for a limited number of available
connections, ii) at each location the axonal branching rate of each
thalamocortical projection is reduced by the total branching density of the
other projections, and iii) the density of axon branching for each
thalamocortical projection is conserved. We demonstrate how a purely
self-organising system can initialise a pattern which can then be faithfully
replicated in multiple neural structures. We show that this minimal model of
barrel self-organisation provides a parsimonious account of data from a range
of classic studies in which intrinsic and extrinsic factors have been
experimentally manipulated.


\section*{Introduction}

\modulolinenumbers{}
\linenumbers

Spatial patterns in neural connectivity provide clues about the constraints
under which brains evolve and develop. Whether or not patterning governs
information processing, models of the development of information processing
circuits can be validated in terms of their ability to account for biological
patterning (\citealp{Purves1992}; see also
\citealp{Wilson2015,Bednar2016}). One of the most distinctive patterns of
neural connectivity is found in the rodent barrel cortex
(\citealp{Woolsey1948,Woolsey1970,Welker1974}, see
\citealp{Fox2008}). Understanding how this particular pattern forms might shed
light on the interplay of genetic and extrinsic factors that shape cortical
circuits, and on a wealth of anatomical, physiological, and behavioural data
obtained using this model system.

The barrels are large cortical columns, identifiable from birth in layer 4 of
rodent primary somatosensory cortex as dense clusters of thalamocortical
axons, which are enclosed by borders a few neurons thick from postnatal day 3
\citep{Erzurumlu2012}. In the plane tangential to the cortical surface the
barrels constitute a map of the arrangement of the whiskers on the face, such
that the cells of adjacent barrels respond most strongly and most quickly to
deflection of adjacent whiskers \citep{Armstrong-James1992}. The barrels
reflect subcortical whisker maps comprising cellular aggregates known as
barrelettes in the brainstem and barreloids in the thalamus
\citep{Killackey1980}.

Each whisker and its corresponding barrelette, barreloid, and barrel can be
identified by its position on a two-dimensional grid
\citep{Zucker1969,Killackey1980,Loos1976}. The barrels are normally up to
twice as long in the axis aligned to the grid ‘rows’ compared to the ‘arcs’,
and the rows are visible from day 2 \citep{Rebsam2002} whereas the arcs become
distinct by day 3 \citep{Erzurumlu2012,Rebsam2002}. In metabotropic glutamate
receptor 5 (mGlu5) knockouts the barrel rows develop but the arcs do not
(\citealp{Hannan2001} see also \citealp{Fox2008}), thus distinct processes
likely guide development of the barrels with respect to the orthogonal grid
axes.

Barrel formation requires afferent input, driven by whisker stimulation and by
thalamic calcium waves that propagate via mGlu5-receptor activation
(\citealp{Anton2019}, see also \citealp{Anton2018}). Patterning also depends
on a complex network of axon guidance processes, which includes interactions
between guidance molecules like ephrin-A5 and A7 \citep{Miller2006} and
between adhesion molecules like cadherin-6 and 8 \citep{Greig2013,Bishop2000},
and the binding of p75 to neurotropins (\citealp{Shimogori2005,Bishop2002};
see also \citealp{Dye2011a,Dye2011b}). This network is orchestrated by
interactions between morphogens Fgf8 and Fgf17 and transcription factors Emx2,
Pax6, Sp8, and Coup-tf1 \citep{Shimogori2005,Bishop2000}, which are expressed
in gradients that mark orthogonal axes and can be manipulated to cause the
barrels to stretch, shrink, shift, skew, and even duplicate
\citep{Shimogori2005,Assimacopoulos2012,Borello2014,Sahara2007,Ypsilanti2016,Sur2005}.

The boundaries of the barrels form polygonal shapes that together create a
Voronoi tesselation across the cortical sheet, wherein all points enclosed by
a given boundary are closer to its center than to the center of any other
boundary \citep{Senft1991}. This patterning suggests that the barrel topology
may be preserved in the initial projection of the thalamocortical axons into
the cortex, and that a barrel forms by the lateral branching of the axons from
their initial centres of mass, which ceases upon contact with the axons
branching from adjacent centres. According to this model the barrel pattern
could be entirely determined by the distribution of the initial centre points,
which would itself be determined by guidance cues. However, the assumption of
pre-arranged centres is difficult to resolve with the observation that
thalamocortical axons arrive in the cortical plate as an undifferentiated
bundle prior to barreloid formation (see \citealp{Erzurumlu2012} for a
review).

Alternatively, reaction-diffusion dynamics could generate a Voronoi-like
tesselation in the cortex without the need for pre-arranged centres, by
amplifying characteristic modes in the noisy initial distribution of bundled
axon branches, as a net effect of short-range cooperative and longer-range
competitive interactions between cells. According to this model the barrel
pattern would be determined by the relative strength of these interactions and
by the shape of the cortical field boundary. However, reaction-diffusion
dynamics alone are unlikely to be able to account for the precise
co-registration and topographic connectivity between emergent domains in
thalamus and cortex, the non-uniform sizes and spacing of the barrels to form
rows versus arcs, and the influence of gene expression gradients.

As theories of barrel patterning, the centre-point and reaction-diffusion
models are not mutually exclusive. Pre-organised centres in the initial
conditions could bias reaction-diffusion processes to generate the specific
somatotopic arrangement of barrels more reliably, and similarly the mechanisms
by which axons branch laterally from barrel centres may involve a tension
between cooperative and competitive interactions. However, a proof that barrel
patterning can in principle emerge within an undifferentiated bundle of
thalamocortical axons, based only on local interactions between cells, would
remove the need to invoke a global supervisor, i.e., to assume a separate
stage and/or extrinsic mechanism for pre-organising thalamocortical
connections.

To this end, the aim of the present study is to establish whether it is
possible for the observed arrangement of barrels to self-organise in a system
governed by reaction-diffusion dynamics, under the guidance of molecular
signalling gradients, and in the absence of pre-defined centre-points. Our
approach is to represent in a computational model the minimal set of
biological assumptions that might lead to the emergence of barrel patterning
in simulation, and, if necessary, to add to this minimal set only assumptions
that can be represented by the local exchange of information between adjacent
cells. The emergence of barrel patterning under such conditions would serve as
an existence proof of the plausibility of the hypothesis that barrel
development is a self-organising process.

\section*{Models}

\cite{Karbowski2004} developed what remains, to the best of our knowledge, the
only dynamical model of cortical arealization capable of generating
predictions about the influence of signalling molecules on the size, shape,
and topological organization of emergent cortical fields. This model describes
competition between thalamocortical projections for territory along a
one-dimensional string of cortical cells, e.g., along an anterior-posterior
axis. The equations of the model define how the density of connections, $c$,
and the density of axon branches, $a$, interact at time $t$ at each cortical
location $x$, for $N$ thalamocortical projections indexed by $i$. The Voronoi
tesselation used to describe barrel patterning is a two-dimensional structure,
hence we first extended the original model for simulation on a two-dimensional
cortical sheet, and describe it here as such (i.e., substituting $x$ with the
two-dimensional position vector $\mb{x}$ and substituting terms of the form
$\frac{d}{dx}$ with the two-dimensional spatial gradient operator $\nabla$).

The original model was derived from the assumption that the rates at which
thalamocortical synapses form and thalamocortical axons branch are
reciprocally coupled, resulting in an expression for the change in $c_i$ as a
function of $a_i$, and for the change in $a_i$ as a function of
$c_i$. Synaptogenesis is modelled as

\begin{equation} \label{eq:Karb2DExt_dc}
\frac{\partial c_i(\mb{x},t)}{\partial t} =-\alpha c_i(\mb{x},t) +\beta  \left(1 - \sum_{i'=1}^{N} c_{i'}(\mb{x}, t)\right)[a_i(\mb{x},t)]^k.
\end{equation}

Accordingly, when the final term evaluates to zero, the density of
thalamocortical connections decays exponentially at a rate given by the decay
constant $\alpha$. This occurs where the density of connections over all
thalamic projections sum to one; interpreted as a state in which all of the
available synaptic receptors within the cortical dendritic trees are
occupied. Otherwise, the connection density is assumed to vary non-linearly
($k>1$) with the axon branching density.

Changes in axon branching density are assumed to depend also on the
influence of guidance molecules and on the density of branches at
adjacent cortical locations:

%
\begin{equation} \label{eq:Karb2DExt_da}
\frac{\partial a_i(\mb{x},t)}{\partial t} = \nabla\vcdot\left(D \nabla a_i(\mb{x},t)-a_i(\mb{x},t)\sum_{j=1}^{M} \gamma_{i,j}\nabla \rho_j(\mb{x})\right) - \frac{\partial c_i(\mb{x},t)}{\partial t} + \chi.
\end{equation}

The first term on the right describes the spatial gradient (indicated by
$\nabla\vcdot$) of a quantity referred to in models of heat diffusion as the
`flux' (the term enclosed by parentheses). The central idea in heat diffusion
models is that the change in temperature (over time) at a given location is
proportional to the gradient in the temperature (over space) at that
location. Substituting the branching density for heat, axons from a given
thalamic projection are thus assumed to branch laterally across the cortical
sheet at a rate given by the diffusion constant $D$. Lateral branching is
augmented by a measure of the local alignment between the branching density
and the gradient in the concentration of each of $M$ distinct molecular
signals, $\rho(\mb{x})$. The influence of a given signal (indexed by $j$) on a
given thalamic projection (indexed by $i$), is determined by the parameter
$\gamma_{i,j}$. Interactions for which this value is positive encourage axon
branching in the direction in which the concentration of the signal is
increasing, whereas negative interactions encourage branching in the opposite
direction. Hence the axons of a given thalamic projection are assumed to
branch towards either higher or lower concentrations of each signalling
molecule.

The second term on the right of equation 2 represents an assumption that the
axon branching density decreases when the number of connections being made
increases, and vice versa, i.e., that branches are required to form synaptic
connections. Note that we introduce the term $\chi=0$ here, so that we might
subsequently redefine $\chi$ to introduce the competition between thalamic
projections that we will show to be necessary for the emergence of a Voronoi
tesselation (see Results).

Two points are important to emphasise here. First, notice that the only
difference between thalamic projections is the interaction strengths,
$\gamma$. Hence any differences between the size, shape, and location of
cortical fields that reliably emerge from the dynamics of the model must be
due to differences in the choice of these values only. Second, the formulation
of the model is at this point entirely local, in the sense that simulating the
dynamics requires no information to be communicated from cortical locations to
any but the immediately adjacent locations.

In addition to the choice of initial conditions (for the fields
$c(\mb{x},t=0)$ and $a(\mb{x},t=0)$) and the axon guidance fields
$\rho(\mb{x})$, the free parameters of the model are the number of
thalamocortical projections, $N$, constants $\alpha$, $\beta$, $k$, and $D$,
and the $N\times M$ interaction strengths, $\gamma$.

The dynamics of the model (equations 1 and 2) were solved on a hexagonal
lattice of grid elements representing the cortical sheet, under the assumption
that axon branches cannot extend beyond the boundary of the sheet, i.e.,
$\mb{J}_i(\mb{x},t) \bigg\rvert_{boundary} = 0$. We developed software tools
for imposing arbitrary boundary shapes, specified in a scalable vector
graphics (.svg) file format, on the lattice. The dynamics were numerically
integrated using fourth-order Runge-Kutta, and using a {\color{red} finite
  difference method} to compute the flux term (see Supplementary Materials).

\section*{Results}

\cmnt{If we need to present the results of the 2-D system with $\chi=0$, then
  we'll do that first, showing a 2-D version of the simulation obtained by
  running \code{james0 configs/karb.json}}

We first verified that the system given by Eqns. \ref{eq:Karb2DExt_dc} \&
\ref{eq:Karb2DExt_da} described a two dimensional extension of the axon
branching model in \citet{Karbowski2004}. We showed that in the presence of
three guidance gradients varying only in one dimension (along the long axis of
an elliptical domain), five thalamocortical axon types, each interacting
uniquely with the three guidance gradients, would segregate into five separate
regions. We investigated a number of configurations of the guidance gradients,
varying their shape, $\rho(\mb{x})$, and number, $M$, and their effect on a
varying number of thalamocortical projections, $N$. In general, we were not
able to produce structure in the resulting patterns of the connections,
$c(\mb{x},t\rightarrow\infty)$, which was not present in the guidance
patterns.

Complex structure can indeed be observed in protein expression for some genes,
such as the molecules Bhlhb5 \citep{Joshi2008} and Lmo4
\citep{Cederquist2013,Greig2013}. These expression patterns can therefore
provide a theoretical mechanism for the guidance of axons into distinct
regions, shifting the explanation of how such structures are generated into
the realm of gene transcriptional interactions and mRNA diffusion/movement
(\cmnt{Fixme: find a ref on structure in gene transcription}). However,
complex, stable structure in gene expression is less commonly reported than
homogeneous or simply varying expression, such as Pax6, Emx2, Coup-TF1 which
display graded expression across the entire isocortex
(\cmnt{REFS}). Furthermore, the complex structure observed in the whisker
barrel field has not, to our knowledge, been linked to a complex set of gene
expression patterns matching the scale of the barrels. To investigate how the
whisker barrel structure might form in the presence of only two
coordinate-giving morphogen gradients, we turned our attention to the
competition for connections built into the model.

There exists an element of competition in the model system specified by
Eqns. \ref{eq:Karb2DExt_dc} \& \ref{eq:Karb2DExt_da}. The term $\left(1 -
\sum_{i=1}^{N} c_i(\mb{x}, t)\right)$ ensures that once the available synaptic
receptors in a region have been fully occupied, say by thalamocortical types
$i=2$ and $i=3$, there is no longer the possibility for type $i=1$ to form any
synapses. This competition turns out to be relatively weak, because it does
not strongly affect the branching density in that region; two or more TC axon
types can be branching equally in the region, leading to roughly equal numbers
of connections being made up until the connection limit is reached.

To introduce an element of competition between the branching of
thalamocortical axon types, we introduced the new term $\chi$ given by
%
\begin{equation} \label{eq:branch_comp}
\chi(\mb{x}, t) = - \frac{\epsilon  a_i}{N-1} \sum_{i' \ne i}^{N} a_{i'}(\mb{x}, t)
\end{equation}
%
which leads to a reduction in the rate of increase of branching density for
axon type $i$ in regions where the branching density of \e{other} axon
types is high.

This introduces a new parameter, $\epsilon$, which governs the
strength of the branching competition. The factor $1/(N-1)$ ensures that the
branching competition strength scales with the number of TC axons in the
system.

\subsection*{Competition is required to form somatotopically ordered barrels}

Formation of a grid of domains, with somatotopic ordering.

Fig of domains.

\subsection*{The barrel field reacts to changes in the expression pattern of guidance molecules}

To cover the reaction to changes in the guidance molecules caused by
experiments like those by Shimogori \& Grove.

Linear, circ linear, exponential, etc.

\subsection*{The barrel field reacts to simulated whisker plucking}

A section on whisker plucking?

%\subsubsection*{With surrounding large domains}
%Maybe, put this in to remind myself that I did this. It looks nice.

%\subsection*{Plucking experiments}
%Include results of plucking a single whisker, a row of whiskers and a
%column of whiskers.

%\subsection*{Any parameter sweeps necessary to show behaviour is
%  robust to changes in params}

\subsection*{Extending the model to capture row and arc development}

\subsubsection*{Manipulating Competition: Group competition stronger/weaker than inter-group competition}

Just an idea - have two separate epsilons.

\subsubsection*{Manipulating Guidance: Relative interaction strengths}

One possibility is to modify the strength of the guidance interactions of the
two, orthogonal guidance gradients. In the simulation we modify the magnitude
of the expression of each guidance molecule, although this is equivalent to,
and could stand for a more or less vigourous movement of axons in response to
un-modified guidance gradients.

\subsubsection*{Manipulating Guidance: Delayed onset in one axis}

Another idea; begin with only one guidance gradient, or one strong and
one very weak guidance gradient, and begin the development in this
form, so as to encourage the formation of rows. Subsequently, turn on
the second strong guidance signal.


%\begin{equation}
%\chi=\frac{\epsilon_i  a_i}{N-1} \sum_{j \ne i}^{N} a_j(\mb{x}, t)^l
%\end{equation}

%And normalization step

%\begin{equation}\label{eq:norm_comp8}
%a_i' = n_e \; \frac {a_i} {\textstyle \sum_j^{n_e} a_{i,j} }
%\end{equation}

%($a_i'$ becomes $a_i$ in the next computational step.)

\section*{Discussion}

We set out to test the hypothesis that barrel patterning may emerge via
self-organising processes. We first extended an existing model of neocortical
arealization to simulate pattern formation in two dimensions, inheriting from
this model the assumption that axonal branching and synaptogenesis are
coupled, and that thalamic projections compete for cortical territory under
the influence of molecular signalling gradients. Realistic barrel patterning
emerged only when terms were added to represent the assumption that
thalamocortical projections compete for a limited supply of connections with
cortical cells, that their branching rates are reduced by the branching of
other thalamocortical projections, and that the density of axon branching is
conserved for each projection. The net effect of these local interactions is a
Voronoi tesselation in which localised clusters of thalamic projections become
somatotopically organised on the cortical sheet according to the relative
values of coefficients specifying the rates at which axons are attracted and
repelled by orthogonal pairs of molecular signal gradients. According to this
model, the pattern of barrels is determined by the competitive and cooperative
interactions between cells relative to the shape of the cortical field
boundary. In simulation, we systematically investigated the origin of the
asymmetry between the barrel rows and arcs, and identified {\color{red} XXXXX}
as the most likely candidate for the elongation of barrel shapes along the
rows.

\bibliography{bibfile}

\end{document}


%%%%% ORIGINAL EQUATIONS MAINTAINED AS NOTES HERE FOR REFERENCE

\section*{App 1: Karbowski system with N TCs and M gradients}
%
\begin{equation} \label{eq:Karb2D_dc}
\frac{\partial c_i(\mb{x},t)}{\partial t} = -\alpha c_i(\mb{x},t) + \beta n(\mb{x},t)
[a_i(\mb{x},t)]^k
\end{equation}
%
\begin{equation} \label{eq:Karb2D_conserve}
n(\mb{x},t) = 1 - \sum_{i=1}^{N} c_i(\mb{x}, t)
\end{equation}
%
\begin{equation} \label{eq:Karb2D_da}
\frac{\partial a_i(\mb{x},t)}{\partial t}
= \nabla\vcdot\mb{J}_i(\mb{x},t) - \frac{\partial c_i(\mb{x},t)}{\partial t}
\end{equation}

with the flux current

\begin{equation} \label{eq:Karb2D_J}
\mb{J}_i(\mb{x},t) = D \nabla a_i(\mb{x},t) - a_i
\sum_{j=1}^M \big(\gamma_{i,j} \nabla\rho_j(\mb{x}) \big)
\end{equation}

The boundary condition applied to these equations is:

\begin{equation}
\mb{J}_i(\mb{x},t) \bigg\rvert_{boundary} = 0
\end{equation}

\section{App 2: Karbowski system with N TCs and M gradients plus competition}

%
\begin{equation} \label{eq:Karb2DExt_dc}
\frac{\partial c_i(\mb{x},t)}{\partial t} = -\alpha c_i(\mb{x},t) + \beta n(\mb{x},t)
[a_i(\mb{x},t)]^k
\end{equation}
%
\begin{equation} \label{eq:Karb2DExt_conserve}
n(\mb{x},t) = 1 - \sum_{i=1}^{N} c_i(\mb{x}, t)
\end{equation}
%
\begin{equation} \label{eq:Karb2DExt_da}
\frac{\partial a_i(\mb{x},t)}{\partial t}
= \nabla\vcdot\mb{J}_i(\mb{x},t) - \frac{\partial c_i(\mb{x},t)}{\partial t}- \frac{\epsilon_i  a_i}{N-1} \sum_{j \ne i}^{N} a_j(\mb{x}, t)^l
\end{equation}

And normalization step

\begin{equation}\label{eq:norm_comp8}
a_i' = n_e \; \frac {a_i} {\textstyle \sum_j^{n_e} a_{i,j} }
\end{equation}

($a_i'$ becomes $a_i$ in the next computational step.)
